(function(){"use strict";var a={backendAdapter:"sinonjs",verbose:!1},b=function(){var b={},d={};return{version:"0.6.0",config:function(b){a=_.extend(a,b||{})},backend:function(){return c[a.backendAdapter].backend()},scenario:function(a,c){b[a]=c},groupScenarios:function(a,b){d[a]=b},play:function(){var a=new c.HttpProxy;_.each(_.toArray(arguments),function(c){if(_.isFunction(c))c.call(a);else if(b[c])b[c].call(a);else{if(!d[c])throw"Scenario or Group undefined: "+c;_.each(d[c],function(c){b[c].call(a)})}})}}},c=b();"function"==typeof define&&define.amd?define(["underscore"],function(){return c}):this.smocker=c,c.FixtureResponse=function(a,b,c){this.fixturePath=c,this.matches=function(c,d){return a===c?_.isRegExp(b)?b.test(d):b===d:!1}},c.HttpProxy=function(){var a=c.backend();_.each(["get","post","put","delete"],function(b){var d=b.toUpperCase();this[b]=function(b){return{redirectToFixture:function(c){a.redirect(d,b,c)},respondWith:function(e){a.process(d,b,new c.RequestHandler(e))},forwardToServer:function(){a.forward(d,b)}}}},this)},c.Logger=function(){var b="color:green;font-size:small;",c="color:red;",d="color:blue;",e={group:function(){},groupEnd:function(){},info:function(){}},f=function(){return a.verbose?window.console:e};this.logRequest=function(a,e,g,h){f().group("%csMocker",b),f().info("%crequest:  %c%s",c,d,a+" "+e),f().info({headers:g,body:h})},this.logResponse=function(a,b,e){f().info("%cresponse: %c%s",c,d,a),f().info({headers:b,body:e}),f().groupEnd()}};var d=new c.Logger;c.RequestHandler=function(a){this.response=function(){var b;return b=_.isFunction(a)?a.apply(null,arguments):a,_.tap(new c.ResponseObject(b),function(a){d.logResponse(a.status,a.headers,a.content)})}},c.ResponseObject=function(a){var b=function(){var a=this.headers||{};if(_.isUndefined(a["Content-Type"])||_.isNull(a["Content-Type"])){var b=this.denormalisedContent;(_.isUndefined(b)||_.isNull(b))&&(b={}),_.isObject(b)?(this.headers=_.defaults(a,{"Content-Type":"application/json;charset=utf-8"}),this.content=JSON.stringify(b)):(this.headers=_.defaults(a,{"Content-Type":"text/plain;charset=utf-8"}),this.content=String(b))}},c=function(a){this.status=a.status||200,this.delay=a.delay||0,this.headers=a.headers,this.denormalisedContent=this.content=a.content,b.call(this)};_.isObject(a)?c.call(this,a):c.call(this,{content:a})},function(a){c.angularjs=_.extend(a,{angularModule:function(){return angular.module("smockerFixture",["ng"]).config(["$provide",function(a){a.decorator("$httpBackend",["$delegate",c.angularjs.fixtureHttpBackendDecorator])}]),_.tap(angular.module("smockerE2E",["smockerFixture","ngMockE2E"]),function(a){a.config(["$provide",function(a){a.decorator("$httpBackend",["$delegate",c.angularjs.smockerHttpBackendDecorator])}])})}})}(c.angularjs||{}),function(a){c.angularjs=_.extend(a,{backend:function(){e("angular.module","angular.mock"),this.fixtureResponseMappings=[];var a=this.angularModule(),b=function(b){a.run(["$httpBackend",b])};return{redirect:function(a,c,d){b(function(b){b.when(a.toUpperCase(),c).fixture(d)})},process:function(a,c,e){b(function(b){b.when(a.toUpperCase(),c).respond(function(a,f,g,h){var i=[f,g,h];if(_.isRegExp(c)){var j=c.exec(f).slice(1);i=i.concat(j)}d.logRequest(a,f,h,g);var k=e.response.apply(e,i);return b.responseDelay=k.delay,[k.status,k.content,k.headers]})})},forward:function(a,c){b(function(b){b.when(a.toUpperCase(),c).passThrough()})}}}})}(c.angularjs||{}),function(a){c.angularjs=_.extend(a,{delayInterceptor:function(a,b){return function(){var c=arguments;_.isNumber(a.responseDelay)&&a.responseDelay>0?setTimeout(function(){b.apply(null,c)},1e3*a.responseDelay):b.apply(null,c)}}})}(c.angularjs||{}),function(a){c.angularjs=_.extend(a,{fixtureHttpBackendDecorator:function(a){var b=function(b,d,e,f,g){var h=_.find(c.angularjs.fixtureResponseMappings,function(a){return a.matches(b,d)});return h?a.call(this,"GET",h.fixturePath,e,f,g):a.apply(this,arguments)};return b}})}(c.angularjs||{}),function(a){c.angularjs=_.extend(a,{smockerHttpBackendDecorator:function(a){var b=function(d,e,f,g,h){return a.call(this,d,e,f,c.angularjs.delayInterceptor(b,g),h)};return _.each(_.keys(a),function(c){b[c]=a[c]}),b.when=function(b,d){return _.tap(a.when.apply(this,arguments),function(a){a.fixture=function(a){c.angularjs.fixtureResponseMappings.push(new c.FixtureResponse(b,d,a)),this.passThrough()}})},b}})}(c.angularjs||{}),function(a){var b=function(a){if(_.isRegExp(a))throw"CanJS backend does not support Regular Expression in place of urls."},f=function(a,b){for(var c,d=[],e=/\{([^\/]+)\}/g;_.isObject(b.data)&&(c=e.exec(a));)d.push(b.data[c[1]]);return d};c.canjs=_.extend(a,{backend:function(){return e("can.fixture"),{redirect:function(a,c,d){b(c),can.fixture(a+" "+c,d)},process:function(a,c,e){b(c),can.fixture(a+" "+c,function(b,g,h){d.logRequest(a,b.url,h,b.data);var i=[b.url,b.data,h].concat(f(c,b)),j=e.response.apply(e,i),k=g.bind(null,j.status,"",j.denormalisedContent,j.headers);_.isNumber(j.delay)&&j.delay>0?setTimeout(k,1e3*j.delay):k()})},forward:function(a,c){b(c)}}}})}(c.canjs||{}),function(a){c.sinonjs=_.extend(a,{backend:function(){e("sinon");var a=this.fakeServer();return this.fixtureResponseMappings=[],{redirect:function(a,b,d){c.sinonjs.fixtureResponseMappings.push(new c.FixtureResponse(a.toUpperCase(),b,d))},process:function(b,c,e){a.respondWith(b.toUpperCase(),c,function(){var a=_.toArray(arguments),b=a.shift();d.logRequest(b.method,b.url,b.requestHeaders,b.requestBody);var c=e.response.apply(e,[b.url,b.requestBody,b.requestHeaders].concat(a)),f=b.respond.bind(b,c.status,c.headers,c.content);_.isNumber(c.delay)&&c.delay>0?(b.readyState=4,setTimeout(function(){b.readyState=1,f()},1e3*c.delay)):f()})},forward:function(a,b){sinon.FakeXMLHttpRequest.addFilter(new c.FixtureResponse(a.toUpperCase(),b).matches)}}}})}(c.sinonjs||{}),function(a){c.sinonjs=_.extend(a,{fakeServer:function(){return sinon.FakeXMLHttpRequest.useFilters=!0,sinon.FakeXMLHttpRequest.prototype.open=_.wrap(sinon.FakeXMLHttpRequest.prototype.open,this.xhrOpenFixtureInterceptor),_.tap(sinon.fakeServer.create(),function(a){a.autoRespond=!0})}})}(c.sinonjs||{}),function(a){c.sinonjs=_.extend(a,{xhrOpenFixtureInterceptor:function(a,b,d,e,f,g){var h=_.find(c.sinonjs.fixtureResponseMappings,function(a){return a.matches(b,d)});return h?sinon.FakeXMLHttpRequest.defake(this,["GET",h.fixturePath,e,f,g]):a.call(this,b,d,e,f,g)}})}(c.sinonjs||{});var e=function(){_.each(_.toArray(arguments),function(a){_.inject(a.split("."),function(a,b){if(_.isUndefined(a[b]))throw b+" is not defined. Make sure you load the required library before smocker.js";return a[b]},window)})}}).call(this);